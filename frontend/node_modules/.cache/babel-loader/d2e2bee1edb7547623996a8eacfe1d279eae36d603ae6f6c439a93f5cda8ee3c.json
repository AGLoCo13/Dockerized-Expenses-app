{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ViewPayment(){const[payments,setPayments]=useState([]);const[apartments,setApartments]=useState([]);const[building,setBuilding]=useState(null);useEffect(()=>{const fetchData=async()=>{const token=window.localStorage.getItem('token');if(!token){console.error('No token found in local storage.');return;}try{const profileResponse=await axios.get(\"/api/profile\",{headers:{Authorization:token}});const buildingId=profileResponse.data.profileId;const buildingResponse=await axios.get(\"/api/buildings/\".concat(buildingId),{headers:{Authorization:token}});const fetchedBuilding=buildingResponse.data;setBuilding(fetchedBuilding);const apartmentsResponse=await axios.get(\"/aps/Apartments/\".concat(fetchedBuilding._id),{headers:{Authorization:token}});setApartments(apartmentsResponse.data);const allPaymentsPromises=apartmentsResponse.data.map(apartment=>axios.get(\"/api/payments/\".concat(apartment._id),{headers:{Authorization:token}}).catch(error=>{console.error(\"Error fetching payments for apartment \".concat(apartment._id,\":\"),error);return{data:[]};}));const allPaymentsResponses=await Promise.all(allPaymentsPromises);const allPayments=allPaymentsResponses.flatMap(response=>response.data);setPayments(allPayments);}catch(error){console.error('Error fetching data:',error);}};fetchData();},[]);const deletePayment=async paymentId=>{const confirmDelete=window.confirm(\"Are you sure you want to delete this payment?\");if(!confirmDelete){return;}try{const token=window.localStorage.getItem(\"token\");const response=await axios.delete(\"/api/payments/\".concat(paymentId),{headers:{Aythorization:token}});if(response.status===200){const updatedPayments=payments.filter(payment=>payment._id!==paymentId);setPayments(updatedPayments);}else{console.error('Failed to delete payment');}}catch(error){console.error('Error deleting payment:',error);}};const markAsCompleted=async paymentId=>{const token=window.localStorage.getItem('token');try{const response=await axios.put(\"/api/payments/\".concat(paymentId),{},{headers:{Authorization:token}});//Update local state so the UI reflects the change without having to refresh or re=fetch all data.\nsetPayments(prevPayments=>prevPayments.map(p=>p._id===paymentId?{...p,payment_made:true}:p));}catch(error){console.error(\"Failed to mark payment as Completed:\",error);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-5\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-5\",children:\"Payments\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-striped\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Apartment Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Month\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Year\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Heating\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Elevator\"}),/*#__PURE__*/_jsx(\"th\",{children:\"General\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Payment Made\"}),/*#__PURE__*/_jsx(\"th\",{children:\" Action \"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:payments.map(payment=>{var _apartments$find;const apartmentName=((_apartments$find=apartments.find(apt=>apt._id===payment.apartment))===null||_apartments$find===void 0?void 0:_apartments$find.name)||'Unknown';return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:apartmentName}),/*#__PURE__*/_jsx(\"td\",{children:payment.month}),/*#__PURE__*/_jsx(\"td\",{children:payment.year}),/*#__PURE__*/_jsx(\"td\",{children:payment.total_heating.toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{children:payment.total_elevator.toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{children:payment.total_general.toFixed(2)}),/*#__PURE__*/_jsx(\"td\",{children:payment.payment_made?'Yes':'No'}),/*#__PURE__*/_jsx(\"td\",{children:payment.payment_made?/*#__PURE__*/_jsx(\"button\",{onClick:()=>deletePayment(payment._id),className:\"btn btn-danger\",children:\"Delete\"}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>markAsCompleted(payment._id),className:\"btn btn-primary\",children:\"Tenant Payed\"})})]},payment._id);})})]})]});}export default ViewPayment;","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","ViewPayment","payments","setPayments","apartments","setApartments","building","setBuilding","fetchData","token","window","localStorage","getItem","console","error","profileResponse","get","headers","Authorization","buildingId","data","profileId","buildingResponse","concat","fetchedBuilding","apartmentsResponse","_id","allPaymentsPromises","map","apartment","catch","allPaymentsResponses","Promise","all","allPayments","flatMap","response","deletePayment","paymentId","confirmDelete","confirm","delete","Aythorization","status","updatedPayments","filter","payment","markAsCompleted","put","prevPayments","p","payment_made","className","children","_apartments$find","apartmentName","find","apt","name","month","year","total_heating","toFixed","total_elevator","total_general","onClick"],"sources":["/home/tonyg/Node-React.js-Expenses-Application/frontend/src/components/ViewPayment.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport axios from 'axios';\nfunction ViewPayment() {\n    const [payments , setPayments] = useState([]);\n    const [apartments , setApartments] = useState([]);\n    const [building , setBuilding] = useState(null);\n    useEffect(() => {\n        const fetchData = async () => {\n            const token = window.localStorage.getItem('token');\n            \n            if (!token) {\n                console.error('No token found in local storage.');\n                return;\n            }\n    \n            try {\n                const profileResponse = await axios.get(`/api/profile`, {\n                    headers: { Authorization: token },\n                });\n    \n                const buildingId = profileResponse.data.profileId;\n    \n                const buildingResponse = await axios.get(`/api/buildings/${buildingId}`, {\n                    headers: { Authorization: token },\n                });\n                const fetchedBuilding = buildingResponse.data;\n                setBuilding(fetchedBuilding);\n    \n                const apartmentsResponse = await axios.get(`/aps/Apartments/${fetchedBuilding._id}`, {\n                    headers: { Authorization: token },\n                });\n                setApartments(apartmentsResponse.data);\n    \n                const allPaymentsPromises = apartmentsResponse.data.map((apartment) =>\n                    axios.get(`/api/payments/${apartment._id}`, {\n                        headers: { Authorization: token },\n                    }).catch(error => {\n                        console.error(`Error fetching payments for apartment ${apartment._id}:`, error);\n                        return { data: [] };\n                    })\n                );\n    \n                const allPaymentsResponses = await Promise.all(allPaymentsPromises);\n                const allPayments = allPaymentsResponses.flatMap(response => response.data);\n    \n                setPayments(allPayments);\n    \n            } catch (error) {\n                console.error('Error fetching data:', error);\n            }\n        }\n    \n        fetchData();\n    }, []);\n\n    const deletePayment = async(paymentId) => {\n        const confirmDelete = window.confirm(\"Are you sure you want to delete this payment?\");\n        if (!confirmDelete) {\n            return;\n        }\n    \n    try {\n        const token = window.localStorage.getItem(\"token\");\n        const response = await axios.delete(`/api/payments/${paymentId}`, {\n            headers: {Aythorization: token},\n        });\n\n        if (response.status === 200) {\n            const updatedPayments = payments.filter(payment => payment._id  !== paymentId );\n            setPayments(updatedPayments);\n        } else {\n            console.error('Failed to delete payment');\n        }\n    } catch(error) {\n        console.error('Error deleting payment:' , error);\n    }\n}\n\n    const markAsCompleted = async ( paymentId) => {\n        const token = window.localStorage.getItem('token');\n        try {\n            const response = await axios.put(`/api/payments/${paymentId}`,{} , {\n                headers : {Authorization : token}\n            })\n            //Update local state so the UI reflects the change without having to refresh or re=fetch all data.\n            setPayments(prevPayments => \n                prevPayments.map(p => \n                    p._id === paymentId ? { ...p , payment_made : true} : p\n                    )\n                    );\n                }catch(error) {\n                    console.error(\"Failed to mark payment as Completed:\" , error);\n                }\n        };\n\n\n    \n  return (\n    <div className=\"container mt-5\">\n            <h1 className=\"mb-5\">Payments</h1>\n            <table className=\"table table-striped\">\n                <thead>\n                    <tr>\n                        <th>Apartment Name</th>\n                        <th>Month</th>\n                        <th>Year</th>\n                        <th>Heating</th>\n                        <th>Elevator</th>\n                        <th>General</th>\n                        <th>Payment Made</th>\n                        <th> Action </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {payments.map(payment => {\n                        const apartmentName = apartments.find(apt => apt._id === payment.apartment)?.name || 'Unknown';\n\n                        return (\n                            <tr key={payment._id}>\n                                <td>{apartmentName}</td>\n                                <td>{payment.month}</td>\n                                <td>{payment.year}</td>\n                                <td>{payment.total_heating.toFixed(2)}</td>\n                                <td>{payment.total_elevator.toFixed(2)}</td>\n                                <td>{payment.total_general.toFixed(2)}</td>\n                                <td>{payment.payment_made ? 'Yes' : 'No'}</td>\n                                <td>\n                                    { payment.payment_made ? \n                                         <button onClick={() => deletePayment(payment._id)} className='btn btn-danger'>\n                                            Delete\n                                         </button>\n                                         :\n                                         <button onClick={() => markAsCompleted(payment._id)} className='btn btn-primary'>\n                                            Tenant Payed\n                                            </button>\n                                            }\n                                    \n                                </td>\n                            </tr>\n                        );\n                    })}\n                </tbody>\n            </table>\n        </div>\n  )\n}\n\nexport default ViewPayment\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}